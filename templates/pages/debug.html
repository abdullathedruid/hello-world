{{define "content"}}
<div class="container mx-auto px-3 sm:px-4 py-4 sm:py-8 max-w-4xl">
    <h1 class="text-xl sm:text-3xl md:text-4xl font-bold text-center text-blue-600 mb-4 sm:mb-8 leading-tight">üöÄ Farcaster MiniApp Debug</h1>
    
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6">
        <!-- Context Information -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-4 sm:p-6">
            <h2 class="text-lg sm:text-xl font-semibold text-gray-700 mb-3 sm:mb-4 flex items-center">
                <span class="mr-2">üìä</span>Context Information
            </h2>
            <div id="context-info" class="space-y-2 text-xs sm:text-sm">
                <p class="text-gray-500">Loading context...</p>
            </div>
        </div>
        
        <!-- User Information -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-4 sm:p-6">
            <h2 class="text-lg sm:text-xl font-semibold text-gray-700 mb-3 sm:mb-4 flex items-center">
                <span class="mr-2">üë§</span>User Information
            </h2>
            <div id="user-info" class="space-y-2 text-xs sm:text-sm">
                <p class="text-gray-500">Loading user info...</p>
            </div>
        </div>
        
        <!-- Location & Platform -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-4 sm:p-6">
            <h2 class="text-lg sm:text-xl font-semibold text-gray-700 mb-3 sm:mb-4 flex items-center">
                <span class="mr-2">üìç</span>Location & Platform
            </h2>
            <div id="location-info" class="space-y-2 text-xs sm:text-sm">
                <p class="text-gray-500">Loading location info...</p>
            </div>
        </div>
        
        <!-- SDK Status -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-4 sm:p-6">
            <h2 class="text-lg sm:text-xl font-semibold text-gray-700 mb-3 sm:mb-4 flex items-center">
                <span class="mr-2">‚öôÔ∏è</span>SDK Status
            </h2>
            <div id="sdk-status" class="space-y-2 text-xs sm:text-sm">
                <p class="text-gray-500">Initializing SDK...</p>
            </div>
        </div>
        
        <!-- Actions & Methods -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-4 sm:p-6 lg:col-span-2">
            <h2 class="text-lg sm:text-xl font-semibold text-gray-700 mb-3 sm:mb-4 flex items-center">
                <span class="mr-2">üéØ</span>Available Actions
            </h2>
            <div class="grid grid-cols-1 sm:grid-cols-3 gap-3 sm:gap-4">
                <button id="refresh-btn" class="bg-blue-500 hover:bg-blue-600 active:bg-blue-700 text-white font-semibold py-3 px-4 rounded-lg transition-all duration-200 touch-manipulation text-sm">
                    üîÑ Refresh Data
                </button>
                <button id="close-btn" class="bg-red-500 hover:bg-red-600 active:bg-red-700 text-white font-semibold py-3 px-4 rounded-lg transition-all duration-200 touch-manipulation text-sm">
                    ‚ùå Close MiniApp
                </button>
                <button id="external-link-btn" class="bg-purple-500 hover:bg-purple-600 active:bg-purple-700 text-white font-semibold py-3 px-4 rounded-lg transition-all duration-200 touch-manipulation text-sm">
                    üîó Open External Link
                </button>
            </div>
            <div id="action-result" class="mt-4"></div>
        </div>
        
        <!-- Viewport & Safe Areas (Mobile-specific) -->
        <div class="bg-gradient-to-br from-green-50 to-blue-50 rounded-xl shadow-sm border border-green-100 p-4 sm:p-6 lg:col-span-2">
            <h2 class="text-lg sm:text-xl font-semibold text-gray-700 mb-3 sm:mb-4 flex items-center">
                <span class="mr-2">üì±</span>Viewport & Safe Areas
            </h2>
            <div id="viewport-info" class="grid grid-cols-1 sm:grid-cols-2 gap-4 text-xs sm:text-sm">
                <div class="bg-white/70 rounded-lg p-3">
                    <div class="font-medium text-gray-600 mb-2">Current Viewport:</div>
                    <div id="current-viewport" class="text-gray-800">Loading...</div>
                </div>
                <div class="bg-white/70 rounded-lg p-3">
                    <div class="font-medium text-gray-600 mb-2">Safe Area Insets:</div>
                    <div id="safe-areas" class="text-gray-800">Loading...</div>
                </div>
            </div>
        </div>
        
        <!-- Raw Data -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-4 sm:p-6 lg:col-span-2">
            <h2 class="text-lg sm:text-xl font-semibold text-gray-700 mb-3 sm:mb-4 flex items-center">
                <span class="mr-2">üîç</span>Raw SDK Data
            </h2>
            <pre id="raw-data" class="bg-gray-50 p-3 sm:p-4 rounded-lg text-xs overflow-auto max-h-48 sm:max-h-64 border">
Loading SDK data...
            </pre>
        </div>
    </div>
    
    <div class="text-center mt-6 sm:mt-8">
        <a href="/" class="inline-flex items-center text-blue-500 hover:text-blue-700 font-semibold py-2 px-4 rounded-lg hover:bg-blue-50 transition-colors duration-200">
            ‚Üê Back to Home
        </a>
    </div>
</div>

<script type="module">
    import { sdk } from 'https://esm.sh/@farcaster/miniapp-sdk'
    
    let sdkReady = false;
    let contextData = null;
    
    async function initializeSDK() {
        try {
            await sdk.actions.ready();
            sdkReady = true;
            contextData = await sdk.context;
            updateDisplay();
            document.getElementById('sdk-status').innerHTML = '<div class="text-green-600 font-semibold">‚úÖ SDK Ready</div>';
        } catch (error) {
            console.error('SDK initialization error:', error);
            document.getElementById('sdk-status').innerHTML = '<div class="text-red-600 font-semibold">‚ùå SDK Error: ' + error.message + '</div>';
        }
    }
    
    function updateDisplay() {
        if (!contextData) {
            document.getElementById('raw-data').textContent = 'No context data available';
            return;
        }
        
        const contextHtml = Object.entries(contextData).map(([key, value]) => {
            if (key === 'user') return '';
            return '<div class="flex justify-between border-b pb-1"><span class="font-medium text-gray-600">' + key + ':</span><span class="text-gray-800">' + JSON.stringify(value) + '</span></div>';
        }).filter(html => html).join('');
        document.getElementById('context-info').innerHTML = contextHtml || '<p class="text-gray-500">No context data</p>';
        
        if (contextData.user) {
            const userHtml = Object.entries(contextData.user).map(([key, value]) => 
                '<div class="flex justify-between border-b pb-1"><span class="font-medium text-gray-600">' + key + ':</span><span class="text-gray-800">' + JSON.stringify(value) + '</span></div>'
            ).join('');
            document.getElementById('user-info').innerHTML = userHtml;
        } else {
            document.getElementById('user-info').innerHTML = '<p class="text-gray-500">No user data available</p>';
        }
        
        const locationData = {
            'URL': window.location.href,
            'User Agent': navigator.userAgent,
            'Platform': navigator.platform,
            'Language': navigator.language,
            'Screen Size': screen.width + 'x' + screen.height,
            'Pixel Ratio': window.devicePixelRatio
        };
        
        const locationHtml = Object.entries(locationData).map(([key, value]) => 
            '<div class="flex justify-between border-b pb-1 mb-1"><span class="font-medium text-gray-600">' + key + ':</span><span class="text-gray-800 break-all">' + value + '</span></div>'
        ).join('');
        document.getElementById('location-info').innerHTML = locationHtml;
        
        // Update viewport and safe area information
        updateViewportInfo();
        
        document.getElementById('raw-data').textContent = JSON.stringify(contextData, null, 2);
    }
    
    function updateViewportInfo() {
        // Current viewport
        const viewportInfo = {
            'Width': window.innerWidth + 'px',
            'Height': window.innerHeight + 'px',
            'Ratio': (window.innerWidth / window.innerHeight).toFixed(2),
            'Orientation': window.innerWidth > window.innerHeight ? 'Landscape' : 'Portrait'
        };
        
        const viewportHtml = Object.entries(viewportInfo).map(([key, value]) => 
            '<div class="flex justify-between text-sm mb-1"><span class="text-gray-600">' + key + ':</span><span class="font-medium">' + value + '</span></div>'
        ).join('');
        document.getElementById('current-viewport').innerHTML = viewportHtml;
        
        // Safe area insets from Farcaster SDK
        let safeAreaHtml = '<div class="text-gray-500 text-sm">Not available</div>';
        if (contextData?.client?.safeAreaInsets) {
            const { top, bottom, left, right } = contextData.client.safeAreaInsets;
            safeAreaHtml = `
                <div class="grid grid-cols-2 gap-2 text-sm">
                    <div class="flex justify-between"><span class="text-gray-600">Top:</span><span class="font-medium">${top}px</span></div>
                    <div class="flex justify-between"><span class="text-gray-600">Bottom:</span><span class="font-medium">${bottom}px</span></div>
                    <div class="flex justify-between"><span class="text-gray-600">Left:</span><span class="font-medium">${left}px</span></div>
                    <div class="flex justify-between"><span class="text-gray-600">Right:</span><span class="font-medium">${right}px</span></div>
                </div>
                <div class="mt-2 text-xs text-gray-500">Platform: ${contextData.client.platformType}</div>
            `;
        }
        document.getElementById('safe-areas').innerHTML = safeAreaHtml;
    }
    
    document.getElementById('refresh-btn').addEventListener('click', async () => {
        document.getElementById('action-result').innerHTML = '<div class="bg-blue-50 border border-blue-200 rounded p-2 text-sm">Refreshing data...</div>';
        try {
            contextData = await sdk.context;
            updateDisplay();
            document.getElementById('action-result').innerHTML = '<div class="bg-green-50 border border-green-200 rounded p-2 text-sm text-green-700">‚úÖ Data refreshed successfully</div>';
        } catch (error) {
            document.getElementById('action-result').innerHTML = '<div class="bg-red-50 border border-red-200 rounded p-2 text-sm text-red-700">‚ùå Refresh failed: ' + error.message + '</div>';
        }
    });
    
    document.getElementById('close-btn').addEventListener('click', async () => {
        try {
            await sdk.actions.close();
            document.getElementById('action-result').innerHTML = '<div class="bg-yellow-50 border border-yellow-200 rounded p-2 text-sm text-yellow-700">‚ö†Ô∏è Close action sent</div>';
        } catch (error) {
            document.getElementById('action-result').innerHTML = '<div class="bg-red-50 border border-red-200 rounded p-2 text-sm text-red-700">‚ùå Close failed: ' + error.message + '</div>';
        }
    });
    
    document.getElementById('external-link-btn').addEventListener('click', async () => {
        try {
            await sdk.actions.openUrl('https://docs.farcaster.xyz');
            document.getElementById('action-result').innerHTML = '<div class="bg-green-50 border border-green-200 rounded p-2 text-sm text-green-700">‚úÖ External link opened</div>';
        } catch (error) {
            document.getElementById('action-result').innerHTML = '<div class="bg-red-50 border border-red-200 rounded p-2 text-sm text-red-700">‚ùå Open URL failed: ' + error.message + '</div>';
        }
    });
    
    initializeSDK();
    
    // Handle viewport changes for mobile
    window.addEventListener('resize', () => {
        setTimeout(() => {
            updateViewportInfo();
        }, 100);
    });
    
    // Add touch feedback for buttons
    document.addEventListener('DOMContentLoaded', function() {
        const buttons = document.querySelectorAll('button, a');
        buttons.forEach(button => {
            button.addEventListener('touchstart', function() {
                this.style.transform = 'scale(0.98)';
            });
            
            button.addEventListener('touchend', function() {
                this.style.transform = 'scale(1)';
            });
        });
    });
</script>
{{end}}